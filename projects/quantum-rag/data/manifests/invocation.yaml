feature:
  name: invocation
  display_name: q:invoke
  version: 1.0.0
  status: planned
  category: integration

description:
  short: Universal invocation system for functions, components, APIs, and services
  long: |
    q:invoke provides a unified interface for calling local functions, local components,
    external APIs, and remote services. It eliminates the need for multiple tags by
    using intelligent protocol detection based on attributes.

components:
  ast:
    - InvokeNode
    - InvokeArgumentNode
    - InvokeHeaderNode
    - InvokeParameterNode
    - InvokeBodyNode
  parser:
    - parse_invoke
    - parse_invoke_arg
    - parse_invoke_header
    - parse_invoke_param
    - parse_invoke_body
  runtime:
    - execute_invoke
    - resolve_invocation_target
    - execute_function_invocation
    - execute_component_invocation
    - execute_http_invocation
    - execute_service_invocation

dependencies:
  internal:
    - functions  # For function calls
    - execution_context  # For variable scope
    - validators  # For argument validation
  external:
    - requests  # HTTP requests
    - aiohttp  # Async HTTP (Phase 2)

capabilities:
  phase_1:
    - Local function calls
    - Local component invocation
    - HTTP REST (GET, POST, PUT, DELETE, PATCH)
    - Headers and query parameters
    - JSON request bodies
    - Bearer and API Key authentication
    - Result objects with success/error
    - Basic caching with TTL
  phase_2:
    - GraphQL queries and mutations
    - SOAP web services
    - Remote Quantum services
    - OAuth 2.0 authentication
    - File uploads (multipart/form-data)
    - Retry logic
  phase_3:
    - WebSockets (real-time)
    - gRPC services
    - Message queues (AMQP, Kafka)
    - Streaming responses

attributes:
  required:
    - name  # Result variable name
    - One of: function, component, url, service
  optional:
    - method  # HTTP method (default: GET)
    - type  # Protocol type (graphql, grpc, soap, websocket)
    - timeout  # Timeout in ms (default: 30000)
    - retry  # Retry attempts (default: 0)
    - cache  # Enable caching (default: false)
    - ttl  # Cache TTL in seconds (default: 300)

child_elements:
  - q:arg  # Function/component arguments
  - q:header  # HTTP headers
  - q:param  # Query parameters
  - q:body  # Request body

result_object:
  fields:
    - success  # boolean
    - data  # any
    - error  # object (message, code, details)
    - statusCode  # integer (HTTP only)
    - headers  # object (HTTP only)
    - executionTime  # decimal
    - cached  # boolean

documentation:
  readme: docs/README.md
  api_reference: docs/api.md
  examples: docs/examples.md
  guide: ../../../../docs/guide/invocation.md

testing:
  unit_tests: tests/test_parser.py, tests/test_runtime.py
  integration_tests: tests/test_integration.py
  example_files:
    - examples/test-invoke-function.q
    - examples/test-invoke-component.q
    - examples/test-invoke-http-get.q
    - examples/test-invoke-http-post.q
    - examples/test-invoke-with-cache.q
    - examples/test-invoke-error-handling.q

dataset:
  positive_examples: 30-50
  negative_examples: 5-10
  categories:
    - basic_patterns
    - integration_patterns
    - edge_cases
    - real_world_patterns
    - complex_scenarios

training:
  status: planned
  readiness: not_started

migration:
  breaking_changes: false
  migration_guide: N/A (new feature)

priority: high
estimated_effort: 2-3 weeks
target_release: Q1 2025
