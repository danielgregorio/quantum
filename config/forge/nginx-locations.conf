# Quantum locations snippet
# Save to /etc/nginx/snippets/quantum-locations.conf

# Health check endpoint (no rate limiting)
location /health {
    proxy_pass http://quantum-blue;
    proxy_set_header Host $host;
    proxy_connect_timeout 5s;
    proxy_read_timeout 5s;
    access_log off;
}

# API endpoints
location /api {
    limit_req zone=quantum_limit burst=20 nodelay;

    proxy_pass http://quantum-blue;
    include /etc/nginx/snippets/quantum-proxy.conf;
}

# WebSocket support (for hot reload in dev)
location /ws {
    proxy_pass http://quantum-blue;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_read_timeout 86400;
}

# Static files with caching
location /static {
    alias /var/www/quantum-app/blue/static;
    expires 30d;
    add_header Cache-Control "public, immutable";
    access_log off;
}

# Favicon
location /favicon.ico {
    alias /var/www/quantum-app/blue/static/favicon.ico;
    expires 7d;
    access_log off;
}

# Robots.txt
location /robots.txt {
    alias /var/www/quantum-app/blue/static/robots.txt;
    access_log off;
}

# Main application
location / {
    limit_req zone=quantum_limit burst=50 nodelay;

    proxy_pass http://quantum-blue;
    include /etc/nginx/snippets/quantum-proxy.conf;
}

# Error pages
error_page 500 502 503 504 /50x.html;
location = /50x.html {
    root /var/www/quantum-app/blue/static;
    internal;
}
