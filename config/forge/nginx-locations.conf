# Quantum locations snippet
# Save to /etc/nginx/snippets/quantum-locations.conf

# ===========================================
# VitePress Documentation (root)
# ===========================================

# Main documentation site
location / {
    root /var/www/quantum.sargas.cloud;
    index index.html;
    try_files $uri $uri/ $uri.html =404;

    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}

# ===========================================
# Quantum App Server (/app)
# ===========================================

# Health check endpoint
location /app/health {
    proxy_pass http://quantum-blue/health;
    proxy_set_header Host $host;
    proxy_connect_timeout 5s;
    proxy_read_timeout 5s;
    access_log off;
}

# API endpoints
location /app/api {
    limit_req zone=quantum_limit burst=20 nodelay;
    proxy_pass http://quantum-blue/api;
    include /etc/nginx/snippets/quantum-proxy.conf;
}

# WebSocket support
location /app/ws {
    proxy_pass http://quantum-blue/ws;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_read_timeout 86400;
}

# App static files
location /app/static {
    alias /var/www/quantum-app/blue/static;
    expires 30d;
    add_header Cache-Control "public, immutable";
    access_log off;
}

# Main app
location /app {
    limit_req zone=quantum_limit burst=50 nodelay;
    proxy_pass http://quantum-blue;
    include /etc/nginx/snippets/quantum-proxy.conf;
}

# ===========================================
# Error handling
# ===========================================
error_page 404 /404.html;
error_page 500 502 503 504 /50x.html;
