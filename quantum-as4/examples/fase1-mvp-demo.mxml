<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:mx="http://www.adobe.com/2006/mxml"
               title="FASE 1 MVP Demo">

    <!-- HTTPService for API calls -->
    <s:HTTPService id="userAPI"
                   url="https://jsonplaceholder.typicode.com/users"
                   method="GET"
                   resultFormat="json"
                   showBusyCursor="true"
                   result="handleAPIResult(event)"
                   fault="handleAPIError(event)" />

    <fx:Script>
    <![CDATA[
        [Bindable]
        private var username:String = "";

        [Bindable]
        private var email:String = "";

        [Bindable]
        private var password:String = "";

        [Bindable]
        private var country:String = "";

        [Bindable]
        private var countries:Array = ["USA", "Brazil", "Canada", "Mexico", "UK"];

        [Bindable]
        private var acceptTerms:Boolean = false;

        [Bindable]
        private var uploadProgress:Number = 0;

        [Bindable]
        private var isSubmitting:Boolean = false;

        [Bindable]
        private var apiData:Array = [];

        [Bindable]
        private var profileImage:String = "https://via.placeholder.com/150/3498db/ffffff?text=User";

        [Bindable]
        private var statusMessage:String = "Ready to submit";

        private function submitForm():void {
            // Validation
            if (!username || username.length < 3) {
                Alert.show("Username must be at least 3 characters", "Validation Error", Alert.OK, null, null, Alert.WARNING);
                return;
            }

            if (!email || email.indexOf("@") === -1) {
                Alert.show("Please enter a valid email address", "Validation Error", Alert.OK, null, null, Alert.WARNING);
                return;
            }

            if (!password || password.length < 6) {
                Alert.show("Password must be at least 6 characters", "Validation Error", Alert.OK, null, null, Alert.WARNING);
                return;
            }

            if (!acceptTerms) {
                Alert.show("You must accept the terms and conditions", "Terms Required", Alert.OK, null, null, Alert.ERROR);
                return;
            }

            // Confirm submission
            Alert.show(
                "Are you sure you want to create this account?\n\nUsername: " + username + "\nEmail: " + email,
                "Confirm Registration",
                Alert.YES | Alert.NO,
                null,
                handleConfirm,
                Alert.QUESTION
            );
        }

        private function handleConfirm(event:Object):void {
            if (event.detail === Alert.YES) {
                // Simulate form submission with progress
                isSubmitting = true;
                statusMessage = "Submitting...";
                uploadProgress = 0;

                simulateUpload();
            }
        }

        private function simulateUpload():void {
            // Simulate progress
            var interval = setInterval(function():void {
                uploadProgress += 10;

                if (uploadProgress >= 100) {
                    clearInterval(interval);
                    isSubmitting = false;
                    statusMessage = "Registration successful!";

                    Alert.show(
                        "Your account has been created successfully!\n\nWelcome, " + username + "!",
                        "Success",
                        Alert.OK,
                        null,
                        handleSuccess,
                        Alert.INFO
                    );
                }
            }, 200);
        }

        private function handleSuccess(event:Object):void {
            // Reset form
            username = "";
            email = "";
            password = "";
            country = "";
            acceptTerms = false;
            uploadProgress = 0;
            statusMessage = "Ready to submit";
        }

        private function loadUsers():void {
            statusMessage = "Loading users from API...";
            userAPI.send();
        }

        private function handleAPIResult(event:Object):void {
            apiData = event.result;
            statusMessage = "Loaded " + apiData.length + " users from API";

            Alert.show(
                "Successfully loaded " + apiData.length + " users from JSONPlaceholder API!",
                "API Success",
                Alert.OK,
                null,
                null,
                Alert.INFO
            );
        }

        private function handleAPIError(event:Object):void {
            statusMessage = "API Error: " + event.message;

            Alert.show(
                "Failed to load data from API:\n\n" + event.fault.faultString,
                "API Error",
                Alert.OK,
                null,
                null,
                Alert.ERROR
            );
        }

        private function testImageError():void {
            profileImage = "https://invalid-url-that-does-not-exist.com/image.jpg";
        }

        private function resetImage():void {
            profileImage = "https://via.placeholder.com/150/3498db/ffffff?text=User";
        }

        private function showInfoAlert():void {
            Alert.show(
                "This is an informational message demonstrating the Alert component.",
                "Information",
                Alert.OK,
                null,
                null,
                Alert.INFO
            );
        }

        private function showWarningAlert():void {
            Alert.show(
                "This is a warning message! Be careful.",
                "Warning",
                Alert.OK,
                null,
                null,
                Alert.WARNING
            );
        }

        private function showErrorAlert():void {
            Alert.show(
                "This is an error message! Something went wrong.",
                "Error",
                Alert.OK,
                null,
                null,
                Alert.ERROR
            );
        }

        private function showYesNoAlert():void {
            Alert.show(
                "Do you want to proceed with this action?",
                "Confirm Action",
                Alert.YES | Alert.NO,
                null,
                function(e:Object):void {
                    Alert.show(
                        "You clicked: " + (e.detail === Alert.YES ? "YES" : "NO"),
                        "Result",
                        Alert.OK
                    );
                },
                Alert.QUESTION
            );
        }
    ]]>
    </fx:Script>

    <s:VBox width="100%" height="100%" padding="20" gap="20">
        <!-- Header -->
        <s:Panel title="FASE 1 MVP Demo - Complete Form System" width="100%">
            <s:VBox padding="15" gap="10">
                <s:Label text="Testing: Form, FormItem, HTTPService, ProgressBar, Image, Alert" styleName="subtitle" />
                <s:Label text="{statusMessage}" />
            </s:VBox>
        </s:Panel>

        <!-- Main Content -->
        <s:HBox gap="20" width="100%">
            <!-- Registration Form -->
            <s:Panel title="User Registration" width="500">
                <s:VBox padding="20" gap="15">
                    <!-- Profile Image -->
                    <s:HBox gap="15" horizontalAlign="center">
                        <s:Image source="{profileImage}"
                                 width="150"
                                 height="150"
                                 scaleMode="zoom"
                                 complete="trace('Image loaded')"
                                 ioError="trace('Image failed')" />
                        <s:VBox gap="10">
                            <s:Button label="Test Image Error" click="testImageError()" />
                            <s:Button label="Reset Image" click="resetImage()" />
                        </s:VBox>
                    </s:HBox>

                    <!-- Form -->
                    <s:Form width="100%">
                        <s:FormHeading label="Account Information" />

                        <s:FormItem label="Username" required="true">
                            <s:TextInput text="{username}" width="100%" />
                        </s:FormItem>

                        <s:FormItem label="Email" required="true">
                            <s:TextInput text="{email}" width="100%" />
                        </s:FormItem>

                        <s:FormItem label="Password" required="true">
                            <s:TextInput text="{password}" width="100%" displayAsPassword="true" />
                        </s:FormItem>

                        <s:FormItem label="Country">
                            <s:ComboBox dataProvider="{countries}"
                                        selectedIndex="-1"
                                        prompt="Select a country..." />
                        </s:FormItem>

                        <s:FormHeading label="Terms and Conditions" />

                        <s:FormItem label="">
                            <s:CheckBox label="I accept the terms and conditions"
                                        selected="{acceptTerms}" />
                        </s:FormItem>

                        <!-- Progress Bar -->
                        <s:FormItem label="Upload Progress" visible="{isSubmitting}">
                            <s:ProgressBar value="{uploadProgress}"
                                           maximum="100"
                                           mode="determinate"
                                           width="100%"
                                           height="24"
                                           labelPlacement="center" />
                        </s:FormItem>

                        <!-- Buttons -->
                        <s:FormItem label="">
                            <s:HBox gap="10">
                                <s:Button label="Submit Registration"
                                          click="submitForm()"
                                          enabled="{!isSubmitting}" />
                                <s:Button label="Reset"
                                          click="handleSuccess(event)"
                                          enabled="{!isSubmitting}" />
                            </s:HBox>
                        </s:FormItem>
                    </s:Form>
                </s:VBox>
            </s:Panel>

            <!-- Demo Controls -->
            <s:VBox gap="15" width="350">
                <!-- Alert Demos -->
                <s:Panel title="Alert Component Demos" width="100%">
                    <s:VBox padding="15" gap="10">
                        <s:Label text="Test different alert types:" styleName="subtitle" />
                        <s:Button label="Info Alert" click="showInfoAlert()" width="100%" />
                        <s:Button label="Warning Alert" click="showWarningAlert()" width="100%" />
                        <s:Button label="Error Alert" click="showErrorAlert()" width="100%" />
                        <s:Button label="Yes/No Alert" click="showYesNoAlert()" width="100%" />
                    </s:VBox>
                </s:Panel>

                <!-- API Demo -->
                <s:Panel title="HTTPService Demo" width="100%">
                    <s:VBox padding="15" gap="10">
                        <s:Label text="Test REST API integration:" styleName="subtitle" />
                        <s:Button label="Load Users from API"
                                  click="loadUsers()"
                                  width="100%" />
                        <s:Label text="{apiData.length} users loaded" visible="{apiData.length > 0}" />
                    </s:VBox>
                </s:Panel>

                <!-- ProgressBar Demos -->
                <s:Panel title="ProgressBar Demos" width="100%">
                    <s:VBox padding="15" gap="15">
                        <s:VBox gap="5">
                            <s:Label text="Determinate (0%):" />
                            <s:ProgressBar value="0" mode="determinate" width="100%" />
                        </s:VBox>

                        <s:VBox gap="5">
                            <s:Label text="Determinate (50%):" />
                            <s:ProgressBar value="50" mode="determinate" width="100%" />
                        </s:VBox>

                        <s:VBox gap="5">
                            <s:Label text="Determinate (100%):" />
                            <s:ProgressBar value="100" mode="determinate" width="100%" />
                        </s:VBox>

                        <s:VBox gap="5">
                            <s:Label text="Indeterminate (loading):" />
                            <s:ProgressBar mode="indeterminate" width="100%" />
                        </s:VBox>
                    </s:VBox>
                </s:Panel>
            </s:VBox>
        </s:HBox>
    </s:VBox>
</s:Application>
