[
  {
    "description": "Query with q:loop to display all results",
    "code": "<q:query name=\"users\" datasource=\"app-db\">\n    SELECT * FROM users\n</q:query>\n<q:loop items=\"{users}\" var=\"user\">\n  <div>Name: {user.name}, Email: {user.email}</div>\n</q:loop>",
    "expected_behavior": "Executes query and loops through all users to display their information",
    "use_case": "Rendering database records as UI elements"
  },
  {
    "description": "Query with q:if for conditional execution",
    "code": "<q:set name=\"user_id\" value=\"123\" />\n<q:if condition=\"{user_id} > 0\">\n  <q:query name=\"user\" datasource=\"app-db\">\n      SELECT * FROM users WHERE id = :id\n      <q:param name=\"id\" value=\"{user_id}\" type=\"integer\" />\n  </q:query>\n</q:if>",
    "expected_behavior": "Executes query only if user_id is greater than 0",
    "use_case": "Conditional database queries based on runtime conditions"
  },
  {
    "description": "Query with state variable for parameter binding",
    "code": "<q:set name=\"search_term\" value=\"'laptop'\" />\n<q:query name=\"products\" datasource=\"app-db\">\n    SELECT * FROM products WHERE name LIKE :term\n    <q:param name=\"term\" value=\"{search_term}\" type=\"string\" />\n</q:query>",
    "expected_behavior": "Uses state variable search_term as query parameter to find matching products",
    "use_case": "Dynamic queries based on application state"
  },
  {
    "description": "Multiple queries with state accumulation",
    "code": "<q:query name=\"userCount\" datasource=\"app-db\">\n    SELECT COUNT(*) as count FROM users\n</q:query>\n<q:set name=\"total_users\" value=\"{userCount.count}\" />\n<q:query name=\"productCount\" datasource=\"app-db\">\n    SELECT COUNT(*) as count FROM products\n</q:query>\n<q:set name=\"total_products\" value=\"{productCount.count}\" />\n<div>Users: {total_users}, Products: {total_products}</div>",
    "expected_behavior": "Executes multiple queries and stores counts in state variables for display",
    "use_case": "Dashboard statistics gathering from multiple tables"
  },
  {
    "description": "Loop with nested query for related data",
    "code": "<q:query name=\"categories\" datasource=\"app-db\">\n    SELECT * FROM categories\n</q:query>\n<q:loop items=\"{categories}\" var=\"category\">\n  <h3>{category.name}</h3>\n  <q:query name=\"categoryProducts\" datasource=\"app-db\">\n      SELECT * FROM products WHERE category_id = :cat_id\n      <q:param name=\"cat_id\" value=\"{category.id}\" type=\"integer\" />\n  </q:query>\n  <q:loop items=\"{categoryProducts}\" var=\"product\">\n    <div>{product.name} - ${product.price}</div>\n  </q:loop>\n</q:loop>",
    "expected_behavior": "Displays categories with their associated products using nested queries and loops",
    "use_case": "Hierarchical data display with master-detail relationships"
  },
  {
    "description": "Query with conditional result display",
    "code": "<q:query name=\"orders\" datasource=\"app-db\">\n    SELECT * FROM orders WHERE user_id = :uid\n    <q:param name=\"uid\" value=\"100\" type=\"integer\" />\n</q:query>\n<q:if condition=\"{orders_result.recordCount} > 0\">\n  <q:loop items=\"{orders}\" var=\"order\">\n    <div>Order #{order.id}: {order.status}</div>\n  </q:loop>\n</q:if>\n<q:else>\n  <div>No orders found</div>\n</q:else>",
    "expected_behavior": "Shows orders if found, otherwise displays 'No orders found' message",
    "use_case": "Graceful handling of empty result sets with user feedback"
  },
  {
    "description": "Insert with state variable and immediate query refresh",
    "code": "<q:set name=\"new_email\" value=\"'test@example.com'\" />\n<q:query name=\"newUser\" datasource=\"app-db\">\n    INSERT INTO users (email) VALUES (:email) RETURNING id\n    <q:param name=\"email\" value=\"{new_email}\" type=\"string\" />\n</q:query>\n<q:set name=\"new_user_id\" value=\"{newUser.id}\" />\n<q:query name=\"createdUser\" datasource=\"app-db\">\n    SELECT * FROM users WHERE id = :id\n    <q:param name=\"id\" value=\"{new_user_id}\" type=\"integer\" />\n</q:query>",
    "expected_behavior": "Inserts user, captures the new ID, and immediately fetches the complete record",
    "use_case": "Create-and-fetch pattern for immediate data display"
  },
  {
    "description": "Update with loop for batch operations",
    "code": "<q:set name=\"discount_rate\" value=\"0.9\" />\n<q:query name=\"electronicProducts\" datasource=\"app-db\">\n    SELECT id FROM products WHERE category = :cat\n    <q:param name=\"cat\" value=\"electronics\" type=\"string\" />\n</q:query>\n<q:loop items=\"{electronicProducts}\" var=\"product\">\n  <q:query name=\"applyDiscount\" datasource=\"app-db\">\n      UPDATE products SET price = price * :rate WHERE id = :id\n      <q:param name=\"rate\" value=\"{discount_rate}\" type=\"decimal\" />\n      <q:param name=\"id\" value=\"{product.id}\" type=\"integer\" />\n  </q:query>\n</q:loop>",
    "expected_behavior": "Applies 10% discount to all electronics products through batch updates",
    "use_case": "Batch updates based on query results"
  },
  {
    "description": "Query with computed parameter from state",
    "code": "<q:set name=\"base_price\" value=\"100\" />\n<q:set name=\"tax_rate\" value=\"1.2\" />\n<q:set name=\"final_price\" value=\"{base_price} * {tax_rate}\" />\n<q:query name=\"affordableProducts\" datasource=\"app-db\">\n    SELECT * FROM products WHERE price &lt;= :max_price\n    <q:param name=\"max_price\" value=\"{final_price}\" type=\"decimal\" />\n</q:query>",
    "expected_behavior": "Calculates maximum price from state variables and uses it as query parameter",
    "use_case": "Dynamic query parameters based on calculations"
  },
  {
    "description": "Conditional INSERT based on query result",
    "code": "<q:query name=\"existingUser\" datasource=\"app-db\">\n    SELECT COUNT(*) as count FROM users WHERE email = :email\n    <q:param name=\"email\" value=\"test@example.com\" type=\"string\" />\n</q:query>\n<q:if condition=\"{existingUser.count} == 0\">\n  <q:query name=\"createUser\" datasource=\"app-db\">\n      INSERT INTO users (email) VALUES (:email)\n      <q:param name=\"email\" value=\"test@example.com\" type=\"string\" />\n  </q:query>\n  <div>User created</div>\n</q:if>\n<q:else>\n  <div>User already exists</div>\n</q:else>",
    "expected_behavior": "Checks if user exists before inserting, preventing duplicates",
    "use_case": "Preventing duplicate records with existence checks"
  }
]
